{"ast":null,"code":"import { auth, db } from \"../firebase\";\nimport { onAuthStateChanged, signOut, updateProfile } from \"firebase/auth\";\nimport { doc, setDoc, getDoc } from \"firebase/firestore\";\nexport const subscribeToUser = callback => {\n  return onAuthStateChanged(auth, callback);\n};\nexport const getUserDoc = async uid => {\n  const docRef = doc(db, \"users\", uid);\n  const docSnap = await getDoc(docRef);\n  return docSnap.exists() ? docSnap.data() : null;\n};\nexport const updateUserDoc = async (uid, data) => {\n  const docRef = doc(db, \"users\", uid);\n  await setDoc(docRef, data, {\n    merge: true\n  });\n};\nexport const compressImageToBase64 = (file, maxWidth = 300) => {\n  return new Promise(resolve => {\n    const reader = new FileReader();\n    reader.onload = event => {\n      const img = new Image();\n      img.onload = () => {\n        const canvas = document.createElement(\"canvas\");\n        const scale = maxWidth / img.width;\n        canvas.width = maxWidth;\n        canvas.height = img.height * scale;\n        const ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n        const compressedBase64 = canvas.toDataURL(\"image/jpeg\", 0.6);\n        resolve(compressedBase64);\n      };\n      img.src = event.target.result;\n    };\n    reader.readAsDataURL(file);\n  });\n};\nexport const uploadProfilePhoto = async (file, user) => {\n  if (!file.type.match(/image\\/(jpeg|png)/)) {\n    throw new Error(\"Only JPG/PNG images allowed!\");\n  }\n  const base64 = await compressImageToBase64(file);\n  await updateUserDoc(user.uid, {\n    photoBase64: base64\n  });\n  return base64;\n};\nexport const logout = async () => {\n  await signOut(auth);\n  return true;\n};","map":{"version":3,"names":["auth","db","onAuthStateChanged","signOut","updateProfile","doc","setDoc","getDoc","subscribeToUser","callback","getUserDoc","uid","docRef","docSnap","exists","data","updateUserDoc","merge","compressImageToBase64","file","maxWidth","Promise","resolve","reader","FileReader","onload","event","img","Image","canvas","document","createElement","scale","width","height","ctx","getContext","drawImage","compressedBase64","toDataURL","src","target","result","readAsDataURL","uploadProfilePhoto","user","type","match","Error","base64","photoBase64","logout"],"sources":["/Users/alnura/Desktop/BookStore-React/src/services/profileService.js"],"sourcesContent":["import { auth, db } from \"../firebase\";\nimport { onAuthStateChanged, signOut, updateProfile } from \"firebase/auth\";\nimport { doc, setDoc, getDoc } from \"firebase/firestore\";\n\nexport const subscribeToUser = (callback) => {\n  return onAuthStateChanged(auth, callback);\n};\n\nexport const getUserDoc = async (uid) => {\n  const docRef = doc(db, \"users\", uid);\n  const docSnap = await getDoc(docRef);\n  return docSnap.exists() ? docSnap.data() : null;\n};\n\nexport const updateUserDoc = async (uid, data) => {\n  const docRef = doc(db, \"users\", uid);\n  await setDoc(docRef, data, { merge: true });\n};\n\nexport const compressImageToBase64 = (file, maxWidth = 300) => {\n  return new Promise((resolve) => {\n    const reader = new FileReader();\n    reader.onload = (event) => {\n      const img = new Image();\n      img.onload = () => {\n        const canvas = document.createElement(\"canvas\");\n\n        const scale = maxWidth / img.width;\n        canvas.width = maxWidth;\n        canvas.height = img.height * scale;\n\n        const ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n\n        const compressedBase64 = canvas.toDataURL(\"image/jpeg\", 0.6);\n        resolve(compressedBase64);\n      };\n      img.src = event.target.result;\n    };\n    reader.readAsDataURL(file);\n  });\n};\n\nexport const uploadProfilePhoto = async (file, user) => {\n  if (!file.type.match(/image\\/(jpeg|png)/)) {\n    throw new Error(\"Only JPG/PNG images allowed!\");\n  }\n\n  const base64 = await compressImageToBase64(file);\n\n  await updateUserDoc(user.uid, { photoBase64: base64 });\n\n  return base64;\n};\n\nexport const logout = async () => {\n  await signOut(auth);\n  return true;\n};"],"mappings":"AAAA,SAASA,IAAI,EAAEC,EAAE,QAAQ,aAAa;AACtC,SAASC,kBAAkB,EAAEC,OAAO,EAAEC,aAAa,QAAQ,eAAe;AAC1E,SAASC,GAAG,EAAEC,MAAM,EAAEC,MAAM,QAAQ,oBAAoB;AAExD,OAAO,MAAMC,eAAe,GAAIC,QAAQ,IAAK;EAC3C,OAAOP,kBAAkB,CAACF,IAAI,EAAES,QAAQ,CAAC;AAC3C,CAAC;AAED,OAAO,MAAMC,UAAU,GAAG,MAAOC,GAAG,IAAK;EACvC,MAAMC,MAAM,GAAGP,GAAG,CAACJ,EAAE,EAAE,OAAO,EAAEU,GAAG,CAAC;EACpC,MAAME,OAAO,GAAG,MAAMN,MAAM,CAACK,MAAM,CAAC;EACpC,OAAOC,OAAO,CAACC,MAAM,CAAC,CAAC,GAAGD,OAAO,CAACE,IAAI,CAAC,CAAC,GAAG,IAAI;AACjD,CAAC;AAED,OAAO,MAAMC,aAAa,GAAG,MAAAA,CAAOL,GAAG,EAAEI,IAAI,KAAK;EAChD,MAAMH,MAAM,GAAGP,GAAG,CAACJ,EAAE,EAAE,OAAO,EAAEU,GAAG,CAAC;EACpC,MAAML,MAAM,CAACM,MAAM,EAAEG,IAAI,EAAE;IAAEE,KAAK,EAAE;EAAK,CAAC,CAAC;AAC7C,CAAC;AAED,OAAO,MAAMC,qBAAqB,GAAGA,CAACC,IAAI,EAAEC,QAAQ,GAAG,GAAG,KAAK;EAC7D,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAK;IAC9B,MAAMC,MAAM,GAAG,IAAIC,UAAU,CAAC,CAAC;IAC/BD,MAAM,CAACE,MAAM,GAAIC,KAAK,IAAK;MACzB,MAAMC,GAAG,GAAG,IAAIC,KAAK,CAAC,CAAC;MACvBD,GAAG,CAACF,MAAM,GAAG,MAAM;QACjB,MAAMI,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;QAE/C,MAAMC,KAAK,GAAGZ,QAAQ,GAAGO,GAAG,CAACM,KAAK;QAClCJ,MAAM,CAACI,KAAK,GAAGb,QAAQ;QACvBS,MAAM,CAACK,MAAM,GAAGP,GAAG,CAACO,MAAM,GAAGF,KAAK;QAElC,MAAMG,GAAG,GAAGN,MAAM,CAACO,UAAU,CAAC,IAAI,CAAC;QACnCD,GAAG,CAACE,SAAS,CAACV,GAAG,EAAE,CAAC,EAAE,CAAC,EAAEE,MAAM,CAACI,KAAK,EAAEJ,MAAM,CAACK,MAAM,CAAC;QAErD,MAAMI,gBAAgB,GAAGT,MAAM,CAACU,SAAS,CAAC,YAAY,EAAE,GAAG,CAAC;QAC5DjB,OAAO,CAACgB,gBAAgB,CAAC;MAC3B,CAAC;MACDX,GAAG,CAACa,GAAG,GAAGd,KAAK,CAACe,MAAM,CAACC,MAAM;IAC/B,CAAC;IACDnB,MAAM,CAACoB,aAAa,CAACxB,IAAI,CAAC;EAC5B,CAAC,CAAC;AACJ,CAAC;AAED,OAAO,MAAMyB,kBAAkB,GAAG,MAAAA,CAAOzB,IAAI,EAAE0B,IAAI,KAAK;EACtD,IAAI,CAAC1B,IAAI,CAAC2B,IAAI,CAACC,KAAK,CAAC,mBAAmB,CAAC,EAAE;IACzC,MAAM,IAAIC,KAAK,CAAC,8BAA8B,CAAC;EACjD;EAEA,MAAMC,MAAM,GAAG,MAAM/B,qBAAqB,CAACC,IAAI,CAAC;EAEhD,MAAMH,aAAa,CAAC6B,IAAI,CAAClC,GAAG,EAAE;IAAEuC,WAAW,EAAED;EAAO,CAAC,CAAC;EAEtD,OAAOA,MAAM;AACf,CAAC;AAED,OAAO,MAAME,MAAM,GAAG,MAAAA,CAAA,KAAY;EAChC,MAAMhD,OAAO,CAACH,IAAI,CAAC;EACnB,OAAO,IAAI;AACb,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}