{"ast":null,"code":"import { doc, getDoc, setDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nexport const getFavoritesFromFirestore = async uid => {\n  const docRef = doc(db, 'favorites', uid);\n  const docSnap = await getDoc(docRef);\n  if (docSnap.exists()) {\n    return docSnap.data().books || [];\n  }\n  return [];\n};\nexport const saveFavoritesToFirestore = async (uid, books) => {\n  const docRef = doc(db, 'favorites', uid);\n  await setDoc(docRef, {\n    books\n  });\n};\nexport const getLocalFavorites = () => {\n  return JSON.parse(localStorage.getItem('favorites')) || [];\n};\nexport const saveLocalFavorites = books => {\n  localStorage.setItem('favorites', JSON.stringify(books));\n};\nexport const clearLocalFavorites = () => {\n  localStorage.removeItem('favorites');\n};\nexport const mergeFavorites = (serverFavorites, localFavorites) => {\n  const mergedMap = new Map();\n  serverFavorites.forEach(book => mergedMap.set(book.title, book));\n  localFavorites.forEach(book => mergedMap.set(book.title, book));\n  return Array.from(mergedMap.values());\n};\nexport const loadFavorites = async user => {\n  if (user) {\n    const serverFavorites = await getFavoritesFromFirestore(user.uid);\n    const localFavorites = getLocalFavorites();\n    const merged = mergeFavorites(serverFavorites, localFavorites);\n    if (localFavorites.length > 0) {\n      await saveFavoritesToFirestore(user.uid, merged);\n      clearLocalFavorites();\n      return {\n        favorites: merged,\n        mergedWithLocal: true\n      };\n    } else {\n      await saveFavoritesToFirestore(user.uid, serverFavorites);\n      return {\n        favorites: serverFavorites,\n        mergedWithLocal: false\n      };\n    }\n  } else {\n    return {\n      favorites: getLocalFavorites(),\n      mergedWithLocal: false\n    };\n  }\n};\nexport const saveFavorites = async (user, favorites) => {\n  if (user) {\n    await saveFavoritesToFirestore(user.uid, favorites);\n  } else {\n    saveLocalFavorites(favorites);\n  }\n};\nexport const removeSelected = (favorites, selectedTitles) => {\n  return favorites.filter(book => !selectedTitles.includes(book.title));\n};\nexport const clearAll = () => {\n  return [];\n};\nexport const addSelectedToCart = (favorites, selectedTitles) => {\n  const selectedBooks = favorites.filter(book => selectedTitles.includes(book.title));\n  const existingCart = JSON.parse(localStorage.getItem('cart')) || [];\n  const updatedCart = [...existingCart, ...selectedBooks.filter(book => !existingCart.some(item => item.title === book.title))];\n  localStorage.setItem('cart', JSON.stringify(updatedCart));\n  window.dispatchEvent(new Event('cartUpdated'));\n  return selectedBooks.length;\n};","map":{"version":3,"names":["doc","getDoc","setDoc","db","getFavoritesFromFirestore","uid","docRef","docSnap","exists","data","books","saveFavoritesToFirestore","getLocalFavorites","JSON","parse","localStorage","getItem","saveLocalFavorites","setItem","stringify","clearLocalFavorites","removeItem","mergeFavorites","serverFavorites","localFavorites","mergedMap","Map","forEach","book","set","title","Array","from","values","loadFavorites","user","merged","length","favorites","mergedWithLocal","saveFavorites","removeSelected","selectedTitles","filter","includes","clearAll","addSelectedToCart","selectedBooks","existingCart","updatedCart","some","item","window","dispatchEvent","Event"],"sources":["/Users/alnura/Desktop/BookStore-React/src/services/favoritesService.js"],"sourcesContent":["import { doc, getDoc, setDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\n\nexport const getFavoritesFromFirestore = async (uid) => {\n  const docRef = doc(db, 'favorites', uid);\n  const docSnap = await getDoc(docRef);\n  if (docSnap.exists()) {\n    return docSnap.data().books || [];\n  }\n  return [];\n};\n\nexport const saveFavoritesToFirestore = async (uid, books) => {\n  const docRef = doc(db, 'favorites', uid);\n  await setDoc(docRef, { books });\n};\n\nexport const getLocalFavorites = () => {\n  return JSON.parse(localStorage.getItem('favorites')) || [];\n};\n\nexport const saveLocalFavorites = (books) => {\n  localStorage.setItem('favorites', JSON.stringify(books));\n};\n\nexport const clearLocalFavorites = () => {\n  localStorage.removeItem('favorites');\n};\n\nexport const mergeFavorites = (serverFavorites, localFavorites) => {\n  const mergedMap = new Map();\n\n  serverFavorites.forEach(book => mergedMap.set(book.title, book));\n  localFavorites.forEach(book => mergedMap.set(book.title, book));\n\n  return Array.from(mergedMap.values());\n};\n\nexport const loadFavorites = async (user) => {\n  if (user) {\n    const serverFavorites = await getFavoritesFromFirestore(user.uid);\n    const localFavorites = getLocalFavorites();\n\n    const merged = mergeFavorites(serverFavorites, localFavorites);\n\n    if (localFavorites.length > 0) {\n      await saveFavoritesToFirestore(user.uid, merged);\n      clearLocalFavorites();\n      return { favorites: merged, mergedWithLocal: true };\n    } else {\n      await saveFavoritesToFirestore(user.uid, serverFavorites);\n      return { favorites: serverFavorites, mergedWithLocal: false };\n    }\n  } else {\n    return { favorites: getLocalFavorites(), mergedWithLocal: false };\n  }\n};\n\nexport const saveFavorites = async (user, favorites) => {\n  if (user) {\n    await saveFavoritesToFirestore(user.uid, favorites);\n  } else {\n    saveLocalFavorites(favorites);\n  }\n};\n\nexport const removeSelected = (favorites, selectedTitles) => {\n  return favorites.filter(book => !selectedTitles.includes(book.title));\n};\n\nexport const clearAll = () => {\n  return [];\n};\n\nexport const addSelectedToCart = (favorites, selectedTitles) => {\n  const selectedBooks = favorites.filter(book => selectedTitles.includes(book.title));\n  const existingCart = JSON.parse(localStorage.getItem('cart')) || [];\n\n  const updatedCart = [\n    ...existingCart,\n    ...selectedBooks.filter(book => !existingCart.some(item => item.title === book.title)),\n  ];\n\n  localStorage.setItem('cart', JSON.stringify(updatedCart));\n  window.dispatchEvent(new Event('cartUpdated'));\n\n  return selectedBooks.length;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}