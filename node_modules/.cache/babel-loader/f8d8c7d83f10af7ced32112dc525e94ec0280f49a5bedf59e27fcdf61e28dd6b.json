{"ast":null,"code":"// profileService.js\n\nexport function createImageWorker() {\n  return new Worker(new URL('./imageWorker.js', import.meta.url), {\n    type: 'module'\n  });\n}\nexport const compressImageWithWorker = file => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = e => {\n      const fileDataURL = e.target.result;\n      const worker = createImageWorker();\n      worker.onmessage = async event => {\n        if (event.data.error) {\n          reject(new Error(event.data.error));\n          worker.terminate();\n          return;\n        }\n        if (event.data.compressedBase64) {\n          resolve(event.data.compressedBase64);\n          worker.terminate();\n        } else if (event.data.compressedBlob) {\n          // Если в воркере возвращали Blob, конвертируем в base64:\n          const blob = event.data.compressedBlob;\n          const fr = new FileReader();\n          fr.onload = () => {\n            resolve(fr.result);\n            worker.terminate();\n          };\n          fr.onerror = () => {\n            reject(new Error(\"Failed to convert blob to base64\"));\n            worker.terminate();\n          };\n          fr.readAsDataURL(blob);\n        } else {\n          reject(new Error(\"No data returned from worker\"));\n          worker.terminate();\n        }\n      };\n      worker.onerror = err => {\n        reject(err);\n        worker.terminate();\n      };\n      worker.postMessage({\n        fileDataURL,\n        maxWidth: 300,\n        quality: 0.6\n      });\n    };\n    reader.onerror = () => {\n      reject(new Error(\"Failed to read file\"));\n    };\n    reader.readAsDataURL(file);\n  });\n};","map":{"version":3,"names":["createImageWorker","Worker","URL","import","meta","url","type","compressImageWithWorker","file","Promise","resolve","reject","reader","FileReader","onload","e","fileDataURL","target","result","worker","onmessage","event","data","error","Error","terminate","compressedBase64","compressedBlob","blob","fr","onerror","readAsDataURL","err","postMessage","maxWidth","quality"],"sources":["/Users/alnura/Desktop/BookStore-React/src/pages/profile/Profile.js"],"sourcesContent":["// profileService.js\n\nexport function createImageWorker() {\n  return new Worker(new URL('./imageWorker.js', import.meta.url), { type: 'module' });\n}\n\nexport const compressImageWithWorker = (file) => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onload = (e) => {\n      const fileDataURL = e.target.result;\n      const worker = createImageWorker();\n\n      worker.onmessage = async (event) => {\n        if (event.data.error) {\n          reject(new Error(event.data.error));\n          worker.terminate();\n          return;\n        }\n\n        if (event.data.compressedBase64) {\n          resolve(event.data.compressedBase64);\n          worker.terminate();\n        } \n        else if (event.data.compressedBlob) {\n          // Если в воркере возвращали Blob, конвертируем в base64:\n          const blob = event.data.compressedBlob;\n          const fr = new FileReader();\n          fr.onload = () => {\n            resolve(fr.result);\n            worker.terminate();\n          };\n          fr.onerror = () => {\n            reject(new Error(\"Failed to convert blob to base64\"));\n            worker.terminate();\n          };\n          fr.readAsDataURL(blob);\n        } else {\n          reject(new Error(\"No data returned from worker\"));\n          worker.terminate();\n        }\n      };\n\n      worker.onerror = (err) => {\n        reject(err);\n        worker.terminate();\n      };\n\n      worker.postMessage({ fileDataURL, maxWidth: 300, quality: 0.6 });\n    };\n\n    reader.onerror = () => {\n      reject(new Error(\"Failed to read file\"));\n    };\n\n    reader.readAsDataURL(file);\n  });\n};"],"mappings":"AAAA;;AAEA,OAAO,SAASA,iBAAiBA,CAAA,EAAG;EAClC,OAAO,IAAIC,MAAM,CAAC,IAAIC,GAAG,CAAC,kBAAkB,EAAEC,MAAM,CAACC,IAAI,CAACC,GAAG,CAAC,EAAE;IAAEC,IAAI,EAAE;EAAS,CAAC,CAAC;AACrF;AAEA,OAAO,MAAMC,uBAAuB,GAAIC,IAAI,IAAK;EAC/C,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtC,MAAMC,MAAM,GAAG,IAAIC,UAAU,CAAC,CAAC;IAE/BD,MAAM,CAACE,MAAM,GAAIC,CAAC,IAAK;MACrB,MAAMC,WAAW,GAAGD,CAAC,CAACE,MAAM,CAACC,MAAM;MACnC,MAAMC,MAAM,GAAGnB,iBAAiB,CAAC,CAAC;MAElCmB,MAAM,CAACC,SAAS,GAAG,MAAOC,KAAK,IAAK;QAClC,IAAIA,KAAK,CAACC,IAAI,CAACC,KAAK,EAAE;UACpBZ,MAAM,CAAC,IAAIa,KAAK,CAACH,KAAK,CAACC,IAAI,CAACC,KAAK,CAAC,CAAC;UACnCJ,MAAM,CAACM,SAAS,CAAC,CAAC;UAClB;QACF;QAEA,IAAIJ,KAAK,CAACC,IAAI,CAACI,gBAAgB,EAAE;UAC/BhB,OAAO,CAACW,KAAK,CAACC,IAAI,CAACI,gBAAgB,CAAC;UACpCP,MAAM,CAACM,SAAS,CAAC,CAAC;QACpB,CAAC,MACI,IAAIJ,KAAK,CAACC,IAAI,CAACK,cAAc,EAAE;UAClC;UACA,MAAMC,IAAI,GAAGP,KAAK,CAACC,IAAI,CAACK,cAAc;UACtC,MAAME,EAAE,GAAG,IAAIhB,UAAU,CAAC,CAAC;UAC3BgB,EAAE,CAACf,MAAM,GAAG,MAAM;YAChBJ,OAAO,CAACmB,EAAE,CAACX,MAAM,CAAC;YAClBC,MAAM,CAACM,SAAS,CAAC,CAAC;UACpB,CAAC;UACDI,EAAE,CAACC,OAAO,GAAG,MAAM;YACjBnB,MAAM,CAAC,IAAIa,KAAK,CAAC,kCAAkC,CAAC,CAAC;YACrDL,MAAM,CAACM,SAAS,CAAC,CAAC;UACpB,CAAC;UACDI,EAAE,CAACE,aAAa,CAACH,IAAI,CAAC;QACxB,CAAC,MAAM;UACLjB,MAAM,CAAC,IAAIa,KAAK,CAAC,8BAA8B,CAAC,CAAC;UACjDL,MAAM,CAACM,SAAS,CAAC,CAAC;QACpB;MACF,CAAC;MAEDN,MAAM,CAACW,OAAO,GAAIE,GAAG,IAAK;QACxBrB,MAAM,CAACqB,GAAG,CAAC;QACXb,MAAM,CAACM,SAAS,CAAC,CAAC;MACpB,CAAC;MAEDN,MAAM,CAACc,WAAW,CAAC;QAAEjB,WAAW;QAAEkB,QAAQ,EAAE,GAAG;QAAEC,OAAO,EAAE;MAAI,CAAC,CAAC;IAClE,CAAC;IAEDvB,MAAM,CAACkB,OAAO,GAAG,MAAM;MACrBnB,MAAM,CAAC,IAAIa,KAAK,CAAC,qBAAqB,CAAC,CAAC;IAC1C,CAAC;IAEDZ,MAAM,CAACmB,aAAa,CAACvB,IAAI,CAAC;EAC5B,CAAC,CAAC;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}