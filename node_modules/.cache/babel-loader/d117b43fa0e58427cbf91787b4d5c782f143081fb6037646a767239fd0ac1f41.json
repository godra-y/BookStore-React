{"ast":null,"code":"import { doc, getDoc, setDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nexport const getCartFromFirestore = async uid => {\n  const docRef = doc(db, \"cart\", uid);\n  const snap = await getDoc(docRef);\n  if (snap.exists()) return snap.data().books || [];\n  return [];\n};\nexport const saveCartToFirestore = async (uid, books) => {\n  const docRef = doc(db, \"cart\", uid);\n  await setDoc(docRef, {\n    books\n  });\n};\nexport const getLocalCart = () => {\n  const saved = JSON.parse(localStorage.getItem(\"cart\")) || [];\n  return saved.map(book => ({\n    ...book,\n    quantity: book.quantity || 1\n  }));\n};\nexport const saveLocalCart = books => {\n  localStorage.setItem(\"cart\", JSON.stringify(books));\n};\nexport const clearLocalCart = () => {\n  localStorage.removeItem(\"cart\");\n};\nexport const mergeCarts = (serverCart, localCart) => {\n  const merged = new Map();\n  serverCart.forEach(b => merged.set(b.title, b));\n  localCart.forEach(b => {\n    const existing = merged.get(b.title);\n    merged.set(b.title, {\n      ...b,\n      quantity: existing ? existing.quantity : b.quantity || 1\n    });\n  });\n  return [...merged.values()];\n};\nexport const loadCart = async user => {\n  if (user) {\n    const serverCart = await getCartFromFirestore(user.uid);\n    const localCart = getLocalCart();\n    const merged = mergeCarts(serverCart, localCart);\n\n    // If we had local cart — upload new merged version\n    if (localCart.length > 0) {\n      await saveCartToFirestore(user.uid, merged);\n      clearLocalCart();\n      return {\n        cart: merged,\n        mergedWithLocal: true\n      };\n    }\n    return {\n      cart: serverCart,\n      mergedWithLocal: false\n    };\n  }\n  return {\n    cart: getLocalCart(),\n    mergedWithLocal: false\n  };\n};\nexport const saveCart = async (user, cart) => {\n  if (user) return saveCartToFirestore(user.uid, cart);\n  return saveLocalCart(cart);\n};\n\n/* ---------------------------- CART OPERATIONS ---------------------------- */\n\nexport const removeFromCart = (cart, title) => cart.filter(b => b.title !== title);\nexport const clearCartArray = () => [];\nexport const changeQuantity = (cart, title, delta) => cart.map(b => b.title === title ? {\n  ...b,\n  quantity: Math.max(1, b.quantity + delta)\n} : b);\nexport const toggleSelect = (selected, title) => selected.includes(title) ? selected.filter(t => t !== title) : [...selected, title];\nexport const calculateTotal = (cart, selected) => cart.filter(b => selected.includes(b.title)).reduce((sum, b) => sum + b.price * b.quantity, 0);","map":{"version":3,"names":["doc","getDoc","setDoc","db","getCartFromFirestore","uid","docRef","snap","exists","data","books","saveCartToFirestore","getLocalCart","saved","JSON","parse","localStorage","getItem","map","book","quantity","saveLocalCart","setItem","stringify","clearLocalCart","removeItem","mergeCarts","serverCart","localCart","merged","Map","forEach","b","set","title","existing","get","values","loadCart","user","length","cart","mergedWithLocal","saveCart","removeFromCart","filter","clearCartArray","changeQuantity","delta","Math","max","toggleSelect","selected","includes","t","calculateTotal","reduce","sum","price"],"sources":["/Users/alnura/Desktop/BookStore-React/src/services/cartService.js"],"sourcesContent":["import { doc, getDoc, setDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\n\nexport const getCartFromFirestore = async (uid) => {\n  const docRef = doc(db, \"cart\", uid);\n  const snap = await getDoc(docRef);\n\n  if (snap.exists()) return snap.data().books || [];\n  return [];\n};\n\nexport const saveCartToFirestore = async (uid, books) => {\n  const docRef = doc(db, \"cart\", uid);\n  await setDoc(docRef, { books });\n};\n\nexport const getLocalCart = () => {\n  const saved = JSON.parse(localStorage.getItem(\"cart\")) || [];\n  return saved.map((book) => ({ ...book, quantity: book.quantity || 1 }));\n};\n\nexport const saveLocalCart = (books) => {\n  localStorage.setItem(\"cart\", JSON.stringify(books));\n};\n\nexport const clearLocalCart = () => {\n  localStorage.removeItem(\"cart\");\n};\n\nexport const mergeCarts = (serverCart, localCart) => {\n  const merged = new Map();\n\n  serverCart.forEach((b) => merged.set(b.title, b));\n  localCart.forEach((b) => {\n    const existing = merged.get(b.title);\n    merged.set(b.title, {\n      ...b,\n      quantity: existing ? existing.quantity : b.quantity || 1,\n    });\n  });\n\n  return [...merged.values()];\n};\n\nexport const loadCart = async (user) => {\n  if (user) {\n    const serverCart = await getCartFromFirestore(user.uid);\n    const localCart = getLocalCart();\n\n    const merged = mergeCarts(serverCart, localCart);\n\n    // If we had local cart — upload new merged version\n    if (localCart.length > 0) {\n      await saveCartToFirestore(user.uid, merged);\n      clearLocalCart();\n      return { cart: merged, mergedWithLocal: true };\n    }\n\n    return { cart: serverCart, mergedWithLocal: false };\n  }\n\n  return { cart: getLocalCart(), mergedWithLocal: false };\n};\n\nexport const saveCart = async (user, cart) => {\n  if (user) return saveCartToFirestore(user.uid, cart);\n  return saveLocalCart(cart);\n};\n\n/* ---------------------------- CART OPERATIONS ---------------------------- */\n\nexport const removeFromCart = (cart, title) =>\n  cart.filter((b) => b.title !== title);\n\nexport const clearCartArray = () => [];\n\nexport const changeQuantity = (cart, title, delta) =>\n  cart.map((b) =>\n    b.title === title\n      ? { ...b, quantity: Math.max(1, b.quantity + delta) }\n      : b\n  );\n\nexport const toggleSelect = (selected, title) =>\n  selected.includes(title)\n    ? selected.filter((t) => t !== title)\n    : [...selected, title];\n\nexport const calculateTotal = (cart, selected) =>\n  cart\n    .filter((b) => selected.includes(b.title))\n    .reduce((sum, b) => sum + b.price * b.quantity, 0);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}