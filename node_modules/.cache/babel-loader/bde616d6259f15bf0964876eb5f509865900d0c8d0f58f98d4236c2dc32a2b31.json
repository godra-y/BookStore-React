{"ast":null,"code":"import { doc, getDoc, setDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\nexport const getCartFromFirestore = async uid => {\n  const docRef = doc(db, \"cart\", uid);\n  const docSnap = await getDoc(docRef);\n  if (docSnap.exists()) {\n    return docSnap.data().books || [];\n  }\n  return [];\n};\nexport const saveCartToFirestore = async (uid, books) => {\n  const docRef = doc(db, \"cart\", uid);\n  await setDoc(docRef, {\n    books\n  });\n};\nexport const getLocalCart = () => {\n  const saved = JSON.parse(localStorage.getItem(\"cart\")) || [];\n  return saved.map(book => ({\n    ...book,\n    quantity: book.quantity || 1\n  }));\n};\nexport const saveLocalCart = books => {\n  localStorage.setItem(\"cart\", JSON.stringify(books));\n};\nexport const clearLocalCart = () => {\n  localStorage.removeItem(\"cart\");\n};\nexport const mergeCarts = (serverCart, localCart) => {\n  const mergedMap = new Map();\n  serverCart.forEach(book => mergedMap.set(book.title, book));\n  localCart.forEach(book => {\n    const existing = mergedMap.get(book.title);\n    if (existing) {\n      mergedMap.set(book.title, {\n        ...existing,\n        quantity: book.quantity || 1\n      });\n    } else {\n      mergedMap.set(book.title, {\n        ...book,\n        quantity: book.quantity || 1\n      });\n    }\n  });\n  return Array.from(mergedMap.values());\n};\nexport const loadCart = async user => {\n  if (user) {\n    const serverCart = await getCartFromFirestore(user.uid);\n    const localCart = getLocalCart();\n    const merged = mergeCarts(serverCart, localCart);\n    if (localCart.length > 0) {\n      await saveCartToFirestore(user.uid, merged);\n      clearLocalCart();\n      return {\n        cart: merged,\n        mergedWithLocal: true\n      };\n    } else {\n      await saveCartToFirestore(user.uid, serverCart);\n      return {\n        cart: serverCart,\n        mergedWithLocal: false\n      };\n    }\n  } else {\n    return {\n      cart: getLocalCart(),\n      mergedWithLocal: false\n    };\n  }\n};\nexport const saveCart = async (user, cart) => {\n  if (user) {\n    await saveCartToFirestore(user.uid, cart);\n  } else {\n    saveLocalCart(cart);\n  }\n};\nexport const removeFromCart = (cart, title) => {\n  return cart.filter(book => book.title !== title);\n};\nexport const clearCart = () => {\n  return [];\n};\nexport const changeQuantity = (cart, title, delta) => {\n  return cart.map(book => book.title === title ? {\n    ...book,\n    quantity: Math.max(1, book.quantity + delta)\n  } : book);\n};\nexport const calculateTotalPrice = (cart, selected) => {\n  return cart.filter(book => selected.includes(book.title)).reduce((sum, book) => sum + book.price * book.quantity, 0);\n};","map":{"version":3,"names":["doc","getDoc","setDoc","db","getCartFromFirestore","uid","docRef","docSnap","exists","data","books","saveCartToFirestore","getLocalCart","saved","JSON","parse","localStorage","getItem","map","book","quantity","saveLocalCart","setItem","stringify","clearLocalCart","removeItem","mergeCarts","serverCart","localCart","mergedMap","Map","forEach","set","title","existing","get","Array","from","values","loadCart","user","merged","length","cart","mergedWithLocal","saveCart","removeFromCart","filter","clearCart","changeQuantity","delta","Math","max","calculateTotalPrice","selected","includes","reduce","sum","price"],"sources":["/Users/alnura/Desktop/BookStore-React/src/services/cartService.js"],"sourcesContent":["import { doc, getDoc, setDoc } from \"firebase/firestore\";\nimport { db } from \"../firebase\";\n\nexport const getCartFromFirestore = async (uid) => {\n  const docRef = doc(db, \"cart\", uid);\n  const docSnap = await getDoc(docRef);\n  if (docSnap.exists()) {\n    return docSnap.data().books || [];\n  }\n  return [];\n};\n\nexport const saveCartToFirestore = async (uid, books) => {\n  const docRef = doc(db, \"cart\", uid);\n  await setDoc(docRef, { books });\n};\n\nexport const getLocalCart = () => {\n  const saved = JSON.parse(localStorage.getItem(\"cart\")) || [];\n  return saved.map((book) => ({\n    ...book,\n    quantity: book.quantity || 1,\n  }));\n};\n\nexport const saveLocalCart = (books) => {\n  localStorage.setItem(\"cart\", JSON.stringify(books));\n};\n\nexport const clearLocalCart = () => {\n  localStorage.removeItem(\"cart\");\n};\n\nexport const mergeCarts = (serverCart, localCart) => {\n  const mergedMap = new Map();\n\n  serverCart.forEach((book) => mergedMap.set(book.title, book));\n\n  localCart.forEach((book) => {\n    const existing = mergedMap.get(book.title);\n    if (existing) {\n      mergedMap.set(book.title, { ...existing, quantity: book.quantity || 1 });\n    } else {\n      mergedMap.set(book.title, { ...book, quantity: book.quantity || 1 });\n    }\n  });\n\n  return Array.from(mergedMap.values());\n};\n\nexport const loadCart = async (user) => {\n  if (user) {\n    const serverCart = await getCartFromFirestore(user.uid);\n    const localCart = getLocalCart();\n\n    const merged = mergeCarts(serverCart, localCart);\n\n    if (localCart.length > 0) {\n      await saveCartToFirestore(user.uid, merged);\n      clearLocalCart();\n      return { cart: merged, mergedWithLocal: true };\n    } else {\n      await saveCartToFirestore(user.uid, serverCart);\n      return { cart: serverCart, mergedWithLocal: false };\n    }\n  } else {\n    return { cart: getLocalCart(), mergedWithLocal: false };\n  }\n};\n\nexport const saveCart = async (user, cart) => {\n  if (user) {\n    await saveCartToFirestore(user.uid, cart);\n  } else {\n    saveLocalCart(cart);\n  }\n};\n\nexport const removeFromCart = (cart, title) => {\n  return cart.filter((book) => book.title !== title);\n};\n\nexport const clearCart = () => {\n  return [];\n};\n\nexport const changeQuantity = (cart, title, delta) => {\n  return cart.map((book) =>\n    book.title === title\n      ? { ...book, quantity: Math.max(1, book.quantity + delta) }\n      : book\n  );\n};\n\nexport const calculateTotalPrice = (cart, selected) => {\n  return cart\n    .filter((book) => selected.includes(book.title))\n    .reduce((sum, book) => sum + book.price * book.quantity, 0);\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}